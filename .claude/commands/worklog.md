---
description: セッションの作業内容とgitの変更をもとにObsidianに作業ログを記録する
allowed-tools: Bash(git *), Read, Glob, Grep, Write
---

# 作業ログ記録コマンド

セッション中の作業内容とgitの変更差分を分析し、Obsidianの作業ログとしてmarkdownファイルを作成してください。

## 0. Obsidian Vault パスの確認

環境変数 `OBSIDIAN_VAULT_PATH` からObsidian Vaultのパスを取得してください。

- 設定されていない場合は、ユーザーにパスを聞いてください。その際、「`OBSIDIAN_VAULT_PATH` 環境変数を `~/.zshrc.local` 等に設定しておくと次回から自動で使われます」と案内してください。

保存先は `$OBSIDIAN_VAULT_PATH/AI/Outputs/` です。

## 1. 情報収集

以下を**並列**で実行して情報を集めてください：

### Git情報

- `git branch --show-current` で現在のブランチ名を取得
- `git log --oneline -20` で直近のコミット履歴を取得
- `git diff --stat HEAD~5..HEAD 2>/dev/null || git diff --stat` で変更ファイルの統計を取得
- `git diff HEAD~5..HEAD 2>/dev/null || git diff` で詳細な差分を取得（大きすぎる場合は `--stat` を中心に分析）

### セッションコンテキスト

- このセッション中の会話の流れ（何を依頼され、何を実施したか）を振り返る
- セッション中に作成されたPRがあれば、そのURLを会話履歴から取得する

## 2. 作業ログの作成

収集した情報をもとに、以下のフォーマットでmarkdownファイルを作成してください。

### ファイル名

```
作業ログ_{YYYY-MM-DD}_{作業の要約}.md
```

- ブランチがmain/masterの場合はブランチ名の代わりに作業内容の短い要約を使う
- ファイル名に使えない文字（`/` など）はハイフンに置換する

### ファイル内容

## 概要

{今回の作業の目的と背景を2〜3文で}

## 作業内容

{実施した作業を箇条書きで。セッション中の会話内容とgit差分の両方を反映}

- ...
- ...

## アウトプット

{セッション中に作成されたPRがあれば以下の形式でリンクを記載。なければセクションごと省略}

- PR: {PR URL}

## 学び・気づき

{作業中に得られた知見があれば記載。なければセクションごと省略}

## 次のアクション

{残タスクや次にやるべきことがあれば記載。なければセクションごと省略}

```

## 3. 下書きの提示と確認

ファイルを書き出す前に、下書きの内容をユーザーに提示してください。
ユーザーの確認を得てからファイルを作成してください。

## 4. ファイルの保存

確認が取れたら `$OBSIDIAN_VAULT_PATH/AI/Outputs/` にファイルを保存してください。
保存後、ファイルパスを表示してください。

## 5. Daily Noteへのリンク追加

今日のdaily noteを `$OBSIDIAN_VAULT_PATH` 内で探し、作業ログへのinternal linkを追記してください。

Daily noteのファイル名の形式: `📰{YYYY-MM-DD}({曜日英語3文字}).md`
例: `📰2026-02-17(Tue).md`

- `find` または `Glob` でdaily noteファイルを検索する
- 見つかった場合、ファイルの末尾に以下を追記する:

```markdown
## 作業ログ

- [[作業ログ_{YYYY-MM-DD}_{作業の要約}]]
```

- すでに「作業ログ」セクションがある場合は、そのセクションに箇条書きとして追記する
- ファイルが見つからない場合はユーザーに通知する
```
